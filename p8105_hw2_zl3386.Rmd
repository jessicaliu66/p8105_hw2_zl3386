---
title: "p8105_hw2_zl3386"
author: "Ziqiu Liu"
date: "2023-09-26"
output: github_document
---

```{r, message = FALSE}
library(tidyverse)
library(readxl)
```


## Problem 1

This problem uses the _FiveThirtyEight_ data. 

In particular, we’ll use the data in `pols-month.csv`, `unemployment.csv`, and `snp.csv`. 

Our goal is to merge these into a single data frame using `year` and `month` as keys across datasets.

__First__, clean the data in `pols-month.csv`. 

* Use `separate()` to break up the variable `mon` into integer variables `year`, `month`, and `day`
* Replace month number with month name
* Create a `president` variable taking values `gop` and `dem`, and remove `prez_dem` and `prez_gop`
* Remove the `day` variable.

```{r, message = FALSE}
pols_df = 
  read_csv("data/fivethirtyeight_datasets/pols-month.csv") |>
  janitor::clean_names() |>
  separate(mon, into = c("year", "month", "day"), sep = "/", convert = TRUE) |>
  mutate(
    president = case_match(
      prez_dem,
      1 ~ "dem",
      0 ~ "gop"
    ),
    month = case_match(
      month,
      1 ~ "Jan",
      2 ~ "Feb",
      3 ~ "Mar",
      4 ~ "Apr",
      5 ~ "May",
      6 ~ "Jun",
      7 ~ "Jul",
      8 ~ "Aug",
      9 ~ "Sep",
      10 ~ "Oct",
      11 ~ "Nov",
      12 ~ "Dec"
    )
  ) |>
  select(-starts_with("prez_"), -day)

  
```

__Second__, clean the data in `snp.csv` using a similar process to the above. 

For consistency across datasets, arrange according to `year` and `month`, and organize so that `year` and `month` are the leading columns.

```{r, message = FALSE}
snp_df = 
  read_csv("data/fivethirtyeight_datasets/snp.csv") |>
  janitor::clean_names() 

snp_df_1 = 
  snp_df[1:175,] |>
  janitor::clean_names() |>
  separate(date, into = c("year", "month", "day"), sep = "/", convert = TRUE) 

snp_df_2 = 
  snp_df[176:787,] |>
  janitor::clean_names() |>
  separate(date, into = c("month", "day" ,"year"), sep = "/", convert = TRUE) |>
  relocate(year, month) |>
  mutate(
    year = year + 1900,
    year = replace(year, year == 1900, 2000)
  )

snp_df = 
  rbind(snp_df_1, snp_df_2) |>
  mutate(
    month = case_match(
      month,
      1 ~ "Jan",
      2 ~ "Feb",
      3 ~ "Mar",
      4 ~ "Apr",
      5 ~ "May",
      6 ~ "Jun",
      7 ~ "Jul",
      8 ~ "Aug",
      9 ~ "Sep",
      10 ~ "Oct",
      11 ~ "Nov",
      12 ~ "Dec"
    )
  ) |>
  select(-day) |>
  arrange(year, month)

```

__Third__, tidy the `unemployment` data so that it can be merged with the previous datasets. 

This process will involve switching from “wide” to “long” format; ensuring that key variables have the same name; and ensuring that key variables take the same values.

```{r, message = FALSE}
unemployment_df = 
  read_csv("data/fivethirtyeight_datasets/unemployment.csv") |>
  pivot_longer(
    Jan:Dec,
    names_to = "month",
    values_to = "unemployment_rate"
  ) |>
  janitor::clean_names() 
```

Join the datasets by merging `snp` into `pols`, and merging `unemployment` into the result.

```{r}
results_df =
  full_join(snp_df, pols_df, by = c("year", "month")) |>
  full_join(unemployment_df, by = c("year", "month"))
```

Write a short paragraph about these datasets. Explain briefly what each dataset contained, and describe the resulting dataset (e.g. give the dimension, range of years, and names of key variables).

* Dataset `pols_df` contains the date (`year` and `month`) , the party of the president (`president`) and the number of national politicians who are democratic or republican on the given date.

* Dataset `snp_df` contains 3 columns which indicate the date (`year` and `month`) and the closing values of the S&P stock index on the associated date (`close`).

* Dataset `unemployment_df` contains 3 columns which indicate the date (`year` and `month`) and the corresponding percentage of unemployment (`unemployment_rate`).


## Problem 2

This problem uses the _Mr. Trash Wheel_ dataset.

Read and clean the _Mr. Trash Wheel_ sheet:

* specify the sheet in the Excel file and to omit non-data entries (rows with notes / figures; columns containing notes) using arguments in `read_excel`

* use reasonable variable names

* omit rows that do not include dumpster-specific data

```{r}
trash_wheel_df =
  read_excel(
    "data/Trash Wheel Collection Data.xlsx",
    sheet = 1,
    range = "A2:N586"
  ) |>
  janitor::clean_names()
```

The data include a column for the (approximate) number of homes powered. This calculation is described in the `Homes powered note`, but not applied to every row in the dataset. Update the data to include a new `homes_powered` variable based on this calculation.

```{r homes_powered}
trash_wheel_df =
  mutate(
    trash_wheel_df,
    homes_powered = weight_tons * 500 / 30
  )
```


